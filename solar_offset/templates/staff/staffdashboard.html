<link rel="stylesheet" href="../static/css/staff.css">
<link rel="stylesheet" href="../static/css/homestyle.css">

{% extends 'base.html' %}
<!-- Title Section -->
{% block title %}Staff DashBoard{% endblock %}

<!-- Body Section -->
{% block body %}

    {% include 'flashmessage.html' %}
    <div class="text-center">
        <h3>Welcome to Solar Offset Staff DashBoard: {{ staffname }}</h3>         <!--add this variable to staff.py -->
    </div>
    <div class="container">
        <div class="left-section">
            <h1>esolaroffset</h1>
        </div>

        <div class="right-section">
            {% if countries %}
            <label for="country">Select Country:</label>
            <select id="country" onchange="updateOrganizations()"></select>

            <label for="organization">Select Organization:</label>
            <select id="organization"></select>

            <br>
            <button onclick="location.href='/staff/report'" class="btn btn-outline-success px-4">Generate</button>
            <button onclick="location.href='/staff/report'" class="btn btn-outline-success px-4">Export</button>
           

            <script>
                var countries = [
                    {% for country in countries %}
                    { 
                        "name": "{{ country.name }}", 
                        "country_code": "{{ country.country_code }}",
                        "organizations": "{{ country.org_name }}"
                    },
                    {% endfor %}
                ];
            
                function populateDropdown(selectId, options) {
                    var select = document.getElementById(selectId);
                    select.innerHTML = ""; // Clear existing options
            
                    for (var i = 0; i < options.length; i++) {
                        var option = document.createElement("option");
                        option.text = options[i];
                        option.value = options[i];
                        select.add(option);
                    }
                }
            
                function updateOrganizations() {
                    var countrySelect = document.getElementById("country");
                    var organizationSelect = document.getElementById("organization");
                    var selectedCountry = countrySelect.value;
                    var selectedCountryObjs = countries.filter(country => country.name === selectedCountry);
        
                    console.log(selectedCountryObjs)
                    populateDropdown("organization", selectedCountryObjs);
                }

            
                // Populate the country dropdown initially
                var countryNames = countries.map(country => country.name);
                console.log(countryNames);
                populateDropdown("country", countryNames);
            
                // Update organizations when the country dropdown changes
                updateOrganizations();
            </script>

            {% endif %}
        </div>
    </div>
    <script src="{{ url_for('static', filename='jquery-3.3.1.slim.min.js') }}"></script>
    <script src="{{ url_for('static', filename='popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
{% endblock %}
